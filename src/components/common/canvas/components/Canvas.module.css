/* ==================== Canvas 主容器 ==================== */

.canvas {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: var(--canvas-bg, hsl(var(--background)));
    /* 禁止文字选择 */
    user-select: none;
}

/* ==================== 模式相关光标样式 ==================== */

/* 抓握模式 - 画布显示抓取光标 */
.canvas--mode-grab {
    cursor: grab;
}

.canvas--mode-grab:active {
    cursor: grabbing;
}

/* 常规模式 - 画布显示默认光标 */
.canvas--mode-normal {
    cursor: default;
}

/* 移动模式 - 画布显示十字光标 */
.canvas--mode-move {
    cursor: crosshair;
}

/* 画布拖拽中状态（覆盖模式光标） */
.canvas--panning {
    cursor: grabbing !important;
}

/* Item拖拽中状态 */
.canvas--dragging {
    cursor: move !important;
}

/* 适配动画进行中状态 */
.canvas--animating {
    /* 动画过程中禁用鼠标事件穿透，避免误操作 */
    pointer-events: none;
}

/* 动画过程中恢复鼠标事件，允许用户中断动画 */
.canvas--animating {
    pointer-events: auto;
}

/* 网格背景 */
.canvas--grid {
    background-image: 
        linear-gradient(to right, var(--canvas-grid-color, hsl(var(--border) / 0.3)) 1px, transparent 1px),
        linear-gradient(to bottom, var(--canvas-grid-color, hsl(var(--border) / 0.3)) 1px, transparent 1px);
    background-repeat: repeat;
}

/* ==================== Canvas 内容层 ==================== */

.canvas__content {
    position: absolute;
    top: 0;
    left: 0;
    /* transform-origin 设置为左上角，确保缩放行为正确 */
    transform-origin: 0 0;
    /* 开启硬件加速，同时强制重新栅格化避免缩放模糊 */
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    /* 提升渲染质量 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ==================== 可拖拽Item ==================== */

.canvas__item {
    position: absolute;
    top: 0;
    left: 0;
    /* 圆角边框 */
    border-radius: 8px;
    /* 过渡效果 */
    transition: 
        box-shadow 0.2s ease,
        border-color 0.2s ease;
    /* 边框 */
    border: 2px solid transparent;
    /* 避免缩放时模糊：强制创建独立合成层并重新栅格化 */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    /* 确保图片和文字在缩放时清晰 */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-font-smoothing: antialiased;
}

/* ==================== Item 模式相关光标样式 ==================== */

/* 抓握模式下的item - 继承画布的抓取光标 */
.canvas__item--grab {
    cursor: grab;
}

.canvas__item--grab:active {
    cursor: grabbing;
}

/* 常规模式下的item - 显示指针光标（可双击） */
.canvas__item--normal {
    cursor: pointer;
}

/* 移动模式下的item - 显示移动光标 */
.canvas__item--move {
    cursor: move;
}

/* Item hover状态 */
.canvas__item:hover {
    border-color: hsl(var(--primary) / 0.5);
    box-shadow: 
        0 0 0 1px hsl(var(--primary) / 0.2),
        0 4px 12px hsl(var(--foreground) / 0.1);
}

/* Item选中状态 */
.canvas__item--selected {
    border-color: hsl(var(--primary));
    box-shadow: 
        0 0 0 2px hsl(var(--primary) / 0.3),
        0 8px 24px hsl(var(--foreground) / 0.15);
}

/* Item内容容器 */
.canvas__item-content {
    width: 100%;
    height: 100%;
    /* 防止内容溢出 */
    overflow: hidden;
    border-radius: 6px;
    /* 背景色 */
    background-color: hsl(var(--card));
}

/* 拖拽手柄 - 显示在Item左上角（仅移动模式下显示） */
.canvas__item-handle {
    position: absolute;
    top: -8px;
    left: -8px;
    width: 16px;
    height: 16px;
    background-color: hsl(var(--primary));
    border-radius: 50%;
    border: 2px solid hsl(var(--background));
    cursor: grab;
    opacity: 0;
    transform: scale(0.8);
    transition: 
        opacity 0.2s ease,
        transform 0.2s ease;
    /* 提升层级 */
    z-index: 10;
}

.canvas__item:hover .canvas__item-handle,
.canvas__item--selected .canvas__item-handle {
    opacity: 1;
    transform: scale(1);
}

.canvas__item-handle:active {
    cursor: grabbing;
    transform: scale(1.1);
}

/* ==================== 缩放指示器 ==================== */

.canvas__zoom-indicator {
    position: absolute;
    bottom: 16px;
    right: 16px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 500;
    font-family: var(--font-mono, monospace);
    color: hsl(var(--muted-foreground));
    background-color: hsl(var(--card) / 0.9);
    border: 1px solid hsl(var(--border));
    border-radius: 6px;
    backdrop-filter: blur(8px);
    pointer-events: none;
    /* 动画 */
    transition: opacity 0.2s ease;
    z-index: 100;
}

/* ==================== 模式指示器 ==================== */

.canvas__mode-indicator {
    position: absolute;
    bottom: 16px;
    left: 16px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 500;
    color: hsl(var(--muted-foreground));
    background-color: hsl(var(--card) / 0.9);
    border: 1px solid hsl(var(--border));
    border-radius: 6px;
    backdrop-filter: blur(8px);
    pointer-events: none;
    /* 动画 */
    transition: opacity 0.2s ease;
    z-index: 100;
}

/* ==================== 响应式调整 ==================== */

@media (max-width: 768px) {
    .canvas__zoom-indicator,
    .canvas__mode-indicator {
        bottom: 12px;
        padding: 4px 8px;
        font-size: 11px;
    }

    .canvas__zoom-indicator {
        right: 12px;
    }

    .canvas__mode-indicator {
        left: 12px;
    }

    .canvas__item-handle {
        width: 20px;
        height: 20px;
        top: -10px;
        left: -10px;
    }
}

/* ==================== 无元素提示 ==================== */

.canvas__no-items-hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 200;
    pointer-events: auto;
    /* 入场动画 */
    animation: fadeInScale 0.3s ease-out;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

.canvas__no-items-hint-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 24px 32px;
    background-color: hsl(var(--card) / 0.95);
    border: 1px solid hsl(var(--border));
    border-radius: 12px;
    backdrop-filter: blur(12px);
    box-shadow: 
        0 4px 24px hsl(var(--foreground) / 0.1),
        0 0 0 1px hsl(var(--border) / 0.5);
}

.canvas__no-items-hint-icon {
    font-size: 32px;
    line-height: 1;
}

.canvas__no-items-hint-text {
    font-size: 14px;
    font-weight: 500;
    color: hsl(var(--muted-foreground));
}

.canvas__no-items-hint-button {
    padding: 8px 20px;
    font-size: 14px;
    font-weight: 500;
    color: hsl(var(--primary-foreground));
    background-color: hsl(var(--primary));
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 
        background-color 0.2s ease,
        transform 0.1s ease,
        box-shadow 0.2s ease;
}

.canvas__no-items-hint-button:hover {
    background-color: hsl(var(--primary) / 0.9);
    box-shadow: 0 2px 8px hsl(var(--primary) / 0.3);
}

.canvas__no-items-hint-button:active {
    transform: scale(0.98);
}

/* ==================== 自定义滚动条（如果需要） ==================== */

.canvas::-webkit-scrollbar {
    display: none;
}

.canvas {
    -ms-overflow-style: none;
    scrollbar-width: none;
}
